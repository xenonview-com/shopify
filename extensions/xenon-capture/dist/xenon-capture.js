(()=>{var Oe=Object.create;var L=Object.defineProperty;var Se=Object.getOwnPropertyDescriptor;var De=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols,ve=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var Z=(s,e,t)=>e in s?L(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,P=(s,e)=>{for(var t in e||(e={}))R.call(e,t)&&Z(s,t,e[t]);if(j)for(var t of j(e))ee.call(e,t)&&Z(s,t,e[t]);return s};var te=(s,e)=>{var t={};for(var r in s)R.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&j)for(var r of j(s))e.indexOf(r)<0&&ee.call(s,r)&&(t[r]=s[r]);return t};var re=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var Ce=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of De(e))!R.call(s,o)&&o!==t&&L(s,o,{get:()=>e[o],enumerable:!(r=Se(e,o))||r.enumerable});return s};var Pe=(s,e,t)=>(t=s!=null?Oe(ve(s)):{},Ce(e||!s||!s.__esModule?L(t,"default",{value:s,enumerable:!0}):t,s));var oe=(s,e,t)=>new Promise((r,o)=>{var i=h=>{try{p(t.next(h))}catch(f){o(f)}},c=h=>{try{p(t.throw(h))}catch(f){o(f)}},p=h=>h.done?r(h.value):Promise.resolve(h.value).then(i,c);p((t=t.apply(s,e)).next())});var ie=re((E,se)=>{(function(s,e){typeof E=="object"&&typeof se!="undefined"?e(E):typeof define=="function"&&define.amd?define(["exports"],e):e(s.WHATWGFetch={})})(E,function(s){"use strict";var e=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof global!="undefined"&&global||{},t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(n){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};function r(n){return n&&DataView.prototype.isPrototypeOf(n)}if(t.arrayBuffer)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],i=ArrayBuffer.isView||function(n){return n&&o.indexOf(Object.prototype.toString.call(n))>-1};function c(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(n)||n==="")throw new TypeError('Invalid character in header field name: "'+n+'"');return n.toLowerCase()}function p(n){return typeof n!="string"&&(n=String(n)),n}function h(n){var a={next:function(){var u=n.shift();return{done:u===void 0,value:u}}};return t.iterable&&(a[Symbol.iterator]=function(){return a}),a}function f(n){this.map={},n instanceof f?n.forEach(function(a,u){this.append(u,a)},this):Array.isArray(n)?n.forEach(function(a){if(a.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+a.length);this.append(a[0],a[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(a){this.append(a,n[a])},this)}f.prototype.append=function(n,a){n=c(n),a=p(a);var u=this.map[n];this.map[n]=u?u+", "+a:a},f.prototype.delete=function(n){delete this.map[c(n)]},f.prototype.get=function(n){return n=c(n),this.has(n)?this.map[n]:null},f.prototype.has=function(n){return this.map.hasOwnProperty(c(n))},f.prototype.set=function(n,a){this.map[c(n)]=p(a)},f.prototype.forEach=function(n,a){for(var u in this.map)this.map.hasOwnProperty(u)&&n.call(a,this.map[u],u,this)},f.prototype.keys=function(){var n=[];return this.forEach(function(a,u){n.push(u)}),h(n)},f.prototype.values=function(){var n=[];return this.forEach(function(a){n.push(a)}),h(n)},f.prototype.entries=function(){var n=[];return this.forEach(function(a,u){n.push([u,a])}),h(n)},t.iterable&&(f.prototype[Symbol.iterator]=f.prototype.entries);function D(n){if(!n._noBody){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}}function g(n){return new Promise(function(a,u){n.onload=function(){a(n.result)},n.onerror=function(){u(n.error)}})}function pe(n){var a=new FileReader,u=g(a);return a.readAsArrayBuffer(n),u}function ye(n){var a=new FileReader,u=g(a),m=/charset=([A-Za-z0-9_-]+)/.exec(n.type),y=m?m[1]:"utf-8";return a.readAsText(n,y),u}function be(n){for(var a=new Uint8Array(n),u=new Array(a.length),m=0;m<a.length;m++)u[m]=String.fromCharCode(a[m]);return u.join("")}function W(n){if(n.slice)return n.slice(0);var a=new Uint8Array(n.byteLength);return a.set(new Uint8Array(n)),a.buffer}function Y(){return this.bodyUsed=!1,this._initBody=function(n){this.bodyUsed=this.bodyUsed,this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:t.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:t.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:t.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():t.arrayBuffer&&t.blob&&r(n)?(this._bodyArrayBuffer=W(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):t.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||i(n))?this._bodyArrayBuffer=W(n):this._bodyText=n=Object.prototype.toString.call(n):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var n=D(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var n=D(this);return n||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(t.blob)return this.blob().then(pe);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var n=D(this);if(n)return n;if(this._bodyBlob)return ye(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(be(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(Ae)}),this.json=function(){return this.text().then(JSON.parse)},this}var ge=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function we(n){var a=n.toUpperCase();return ge.indexOf(a)>-1?a:n}function x(n,a){if(!(this instanceof x))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');a=a||{};var u=a.body;if(n instanceof x){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,a.headers||(this.headers=new f(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!u&&n._bodyInit!=null&&(u=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=a.credentials||this.credentials||"same-origin",(a.headers||!this.headers)&&(this.headers=new f(a.headers)),this.method=we(a.method||this.method||"GET"),this.mode=a.mode||this.mode||null,this.signal=a.signal||this.signal||function(){if("AbortController"in e){var l=new AbortController;return l.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&u)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(u),(this.method==="GET"||this.method==="HEAD")&&(a.cache==="no-store"||a.cache==="no-cache")){var m=/([?&])_=[^&]*/;if(m.test(this.url))this.url=this.url.replace(m,"$1_="+new Date().getTime());else{var y=/\?/;this.url+=(y.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}x.prototype.clone=function(){return new x(this,{body:this._bodyInit})};function Ae(n){var a=new FormData;return n.trim().split("&").forEach(function(u){if(u){var m=u.split("="),y=m.shift().replace(/\+/g," "),l=m.join("=").replace(/\+/g," ");a.append(decodeURIComponent(y),decodeURIComponent(l))}}),a}function _e(n){var a=new f,u=n.replace(/\r?\n[\t ]+/g," ");return u.split("\r").map(function(m){return m.indexOf(`
`)===0?m.substr(1,m.length):m}).forEach(function(m){var y=m.split(":"),l=y.shift().trim();if(l){var k=y.join(":").trim();try{a.append(l,k)}catch(I){console.warn("Response "+I.message)}}}),a}Y.call(x.prototype);function w(n,a){if(!(this instanceof w))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(a||(a={}),this.type="default",this.status=a.status===void 0?200:a.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=a.statusText===void 0?"":""+a.statusText,this.headers=new f(a.headers),this.url=a.url||"",this._initBody(n)}Y.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},w.error=function(){var n=new w(null,{status:200,statusText:""});return n.ok=!1,n.status=0,n.type="error",n};var xe=[301,302,303,307,308];w.redirect=function(n,a){if(xe.indexOf(a)===-1)throw new RangeError("Invalid status code");return new w(null,{status:a,headers:{location:n}})},s.DOMException=e.DOMException;try{new s.DOMException}catch(n){s.DOMException=function(a,u){this.message=a,this.name=u;var m=Error(a);this.stack=m.stack},s.DOMException.prototype=Object.create(Error.prototype),s.DOMException.prototype.constructor=s.DOMException}function B(n,a){return new Promise(function(u,m){var y=new x(n,a);if(y.signal&&y.signal.aborted)return m(new s.DOMException("Aborted","AbortError"));var l=new XMLHttpRequest;function k(){l.abort()}l.onload=function(){var b={statusText:l.statusText,headers:_e(l.getAllResponseHeaders()||"")};y.url.indexOf("file://")===0&&(l.status<200||l.status>599)?b.status=200:b.status=l.status,b.url="responseURL"in l?l.responseURL:b.headers.get("X-Request-URL");var S="response"in l?l.response:l.responseText;setTimeout(function(){u(new w(S,b))},0)},l.onerror=function(){setTimeout(function(){m(new TypeError("Network request failed"))},0)},l.ontimeout=function(){setTimeout(function(){m(new TypeError("Network request timed out"))},0)},l.onabort=function(){setTimeout(function(){m(new s.DOMException("Aborted","AbortError"))},0)};function I(b){try{return b===""&&e.location.href?e.location.href:b}catch(S){return b}}if(l.open(y.method,I(y.url),!0),y.credentials==="include"?l.withCredentials=!0:y.credentials==="omit"&&(l.withCredentials=!1),"responseType"in l&&(t.blob?l.responseType="blob":t.arrayBuffer&&(l.responseType="arraybuffer")),a&&typeof a.headers=="object"&&!(a.headers instanceof f||e.Headers&&a.headers instanceof e.Headers)){var Q=[];Object.getOwnPropertyNames(a.headers).forEach(function(b){Q.push(c(b)),l.setRequestHeader(b,p(a.headers[b]))}),y.headers.forEach(function(b,S){Q.indexOf(S)===-1&&l.setRequestHeader(S,b)})}else y.headers.forEach(function(b,S){l.setRequestHeader(S,b)});y.signal&&(y.signal.addEventListener("abort",k),l.onreadystatechange=function(){l.readyState===4&&y.signal.removeEventListener("abort",k)}),l.send(typeof y._bodyInit=="undefined"?null:y._bodyInit)})}B.polyfill=!0,e.fetch||(e.fetch=B,e.Headers=f,e.Request=x,e.Response=w),s.Headers=f,s.Request=x,s.Response=w,s.fetch=B,Object.defineProperty(s,"__esModule",{value:!0})})});var ue=re((Ke,ae)=>{ie();ae.exports=self.fetch.bind(self)});var ne="WebPixel::Render";var N=s=>shopify.extend(ne,s);var $e=Pe(ue());function Te(s){return oe(this,null,function*(){if(s.status>=200&&s.status<400)return s;if(s.status>=400&&s.status<500){let t=yield s.json(),r=new Error(t.error_message);return r.response=s,r.details=t,r.authIssue=!0,Promise.reject(r)}let e=new Error(s.statusText);return e.response=s,Promise.reject(e)})}function ce(s,o={}){var i=o,{accessToken:e,headers:t}=i,r=te(i,["accessToken","headers"]);let c={accept:"application/json"},p=e?{authorization:`Bearer ${e}`}:{};return r=P({credentials:"same-origin",headers:P(P(P({},c),p),t)},r),fetch(s,r).then(Te).then(h=>[204,304].includes(h.status)?{}:h.json()).catch(h=>{if(h instanceof TypeError){let f=new Error("Your internet connection appears to have gone down.");return f.noNet=!0,Promise.reject(f)}return Promise.reject(h)})}var ke="app.xenonview.com",je=`https://${ke}`,F=class{constructor(e={}){let{name:t,method:r,headers:o,url:i,skipName:c,authenticated:p,apiUrl:h}=e;this.authenticated=p||!1,this.skipName=c||!1,this.name=t||"ApiBase",this.method=r||"POST",this.headers=o||{"content-type":"application/json"},this.apiUrl=h||h!=null?h:je,this.path_=i||""}params(e){return{}}path(e){return this.path_}fetch({data:e}={}){let t={};try{t=this.params(e)}catch(i){return Promise.reject(i)}let r={method:this.method,headers:this.headers};if(Object.keys(t).length||!this.skipName){let i={parameters:t};this.skipName||(i.name=this.name);let c=JSON.stringify(i);r.body=c}if(this.authenticated){let{token:i}=e;if(i)r.accessToken=i;else return Promise.reject(new Error("No token and authenticated!"))}let o=`${this.apiUrl}/${this.path(e)}`;return ce(o,r)}},O=F;function Ee(s){let{journey:e}=s;return e?{journey:e}:{}}var H=class extends O{constructor(e){let t={name:"ApiJourney",url:"journey",apiUrl:e,authenticated:!0};super(t)}params(e){let t=Ee(e),{id:r,timestamp:o}=e;return t.uuid=r,t.timestamp=o,t}};function Ue(s){return new H(s)}var le=Ue;function Be(s){let{journey:e}=s;return e?{journey:e}:{}}var X=class extends O{constructor(e){let t={name:"ApiHeartbeat",url:"heartbeat",apiUrl:e,authenticated:!0};super(t)}params(e){let t=Be(e),{id:r,tags:o,platform:i,timestamp:c,watchdog:p}=e;return t.uuid=r,t.timestamp=c,t.tags=o,t.platform=i,p&&(t.watchdog=p),t}};function Ie(s){return new X(s)}var de=Ie;var J=class extends O{constructor(e){let t={name:"ApiDeanonymize",url:"deanonymize",apiUrl:e,authenticated:!0};super(t)}params(e){let{id:t,person:r,timestamp:o}=e;if(!r)throw new Error("No person data received.");let i={};return i.uuid=t,i.person=r,i.timestamp=o,i}};function Le(s){return new J(s)}var fe=Le;var M=class extends O{constructor(e){let t={name:"ApiSample",url:"sample",apiUrl:e,authenticated:!0};super(t)}params(e){let{id:t}=e,r={};return r.uuid=t,r}};function Re(s){return new M(s)}var he=Re;var z={},Ne={setItem:(s,e)=>z[s]=e,getItem:s=>z[s],removeItem:s=>delete z[s]},q={},Fe={setItem:(s,e)=>q[s]=e,getItem:s=>q[s],removeItem:s=>delete q[s]};function V(){return typeof window!="undefined"&&window!==void 0&&window&&window.localStorage?window.localStorage:typeof browser!="undefined"&&browser!==void 0&&browser&&browser.localStorage?browser.localStorage:Fe}function G(){return typeof window!="undefined"&&window!==void 0&&window&&window.sessionStorage?window.sessionStorage:typeof browser!="undefined"&&browser!==void 0&&browser&&browser.sessionStorage?browser.sessionStorage:Ne}function A(s,e){V().setItem(s,JSON.stringify(e))}function v(s){let e=V().getItem(s);return e?JSON.parse(e):null}function T(s){V().removeItem(s)}function C(s,e){G().setItem(s,JSON.stringify(e))}function _(s){let e=G().getItem(s);return e?JSON.parse(e):null}function K(s){G().removeItem(s)}var U=class{constructor(e=null,t="https://app.xenonview.com",r=le,o=fe,i=de,c=he){this.JourneyApi=r,this.DeanonApi=o,this.HeartbeatApi=i,this.SampleApi=c,this.pageURL_=null,this.id(),this.journey()||this.storeJourney([]),this.restoreJourney=[],this.apiUrl=t,e&&this.init(e,t)}init(e,t="https://app.xenonview.com",r=null){this.apiUrl=t,this.apiKey=e,this.sampleDecision(null,r)}ecomAbandonment(){A("heartbeat_type","ecom"),this.heartbeatState(0)}customAbandonment(e){A("heartbeat_type","custom"),A("heartbeat_outcome",e),this.heartbeatState(0)}cancelAbandonment(){A("heartbeat_type","custom"),A("heartbeat_outcome",{remove:!0}),this.heartbeatState(0)}platform(e,t,r,o){C("view-platform",{softwareVersion:e,deviceModel:t,operatingSystemName:r,operatingSystemVersion:o})}removePlatform(){K("view-platform")}variant(e){C("view-tags",e)}resetVariants(){K("view-tags")}leadAttributed(e,t){let r={superOutcome:"Lead Attributed",outcome:e,result:"success"};t&&(r.id=t),this.outcomeAdd(r)}leadCaptured(e){let t={superOutcome:"Lead Capture",outcome:e,result:"success"};this.outcomeAdd(t)}leadCaptureDeclined(e){let t={superOutcome:"Lead Capture",outcome:e,result:"fail"};this.outcomeAdd(t)}accountSignup(e){let t={superOutcome:"Account Signup",outcome:e,result:"success"};this.outcomeAdd(t)}accountSignupDeclined(e){let t={superOutcome:"Account Signup",outcome:e,result:"fail"};this.outcomeAdd(t)}applicationInstalled(){let e={superOutcome:"Application Installation",outcome:"Installed",result:"success"};this.outcomeAdd(e)}applicationNotInstalled(){let e={superOutcome:"Application Installation",outcome:"Not Installed",result:"fail"};this.outcomeAdd(e)}initialSubscription(e,t=null,r=null,o=null){let i={superOutcome:"Initial Subscription",outcome:"Subscribe - "+e,result:"success"};t&&(i.method=t),r&&(i.price=r),o&&(i.term=o),this.outcomeAdd(i)}subscriptionDeclined(e,t=null,r=null,o=null){let i={superOutcome:"Initial Subscription",outcome:"Decline - "+e,result:"fail"};t&&(i.method=t),r&&(i.price=r),o&&(i.term=o),this.outcomeAdd(i)}subscriptionRenewed(e,t=null,r=null,o=null){let i={superOutcome:"Subscription Renewal",outcome:"Renew - "+e,result:"success"};t&&(i.method=t),r&&(i.price=r),o&&(i.term=o),this.outcomeAdd(i)}subscriptionPaused(e,t=null,r=null,o=null){let i={superOutcome:"Subscription Renewal",outcome:"Paused - "+e,result:"fail"};t&&(i.method=t),r&&(i.price=r),o&&(i.term=o),this.outcomeAdd(i)}subscriptionCanceled(e,t=null,r=null,o=null){let i={superOutcome:"Subscription Renewal",outcome:"Cancel - "+e,result:"fail"};t&&(i.method=t),r&&(i.price=r),o&&(i.term=o),this.outcomeAdd(i)}subscriptionUpsold(e,t=null,r=null,o=null){let i={superOutcome:"Subscription Upsold",outcome:"Upsold - "+e,result:"success"};t&&(i.method=t),r&&(i.price=r),o&&(i.term=o),this.outcomeAdd(i)}subscriptionUpsellDeclined(e,t=null,r=null,o=null){let i={superOutcome:"Subscription Upsold",outcome:"Declined - "+e,result:"fail"};t&&(i.method=t),r&&(i.price=r),o&&(i.term=o),this.outcomeAdd(i)}subscriptionDownsell(e,t=null,r=null,o=null){let i={superOutcome:"Subscription Upsold",outcome:"Downsell - "+e,result:"fail"};t&&(i.method=t),r&&(i.price=r),o&&(i.term=o),this.outcomeAdd(i)}adClicked(e,t=null,r=null){let o={superOutcome:"Advertisement",outcome:"Ad Click - "+e,result:"success"};t&&(o.id=t),r&&(o.price=r),this.outcomeAdd(o)}adIgnored(e,t=null,r=null){let o={superOutcome:"Advertisement",outcome:"Ad Ignored - "+e,result:"fail"};t&&(o.id=t),r&&(o.price=r),this.outcomeAdd(o)}referral(e,t=null){let r={superOutcome:"Referral",outcome:"Referred - "+e,result:"success"};t&&(r.details=t),this.outcomeAdd(r)}referralDeclined(e,t=null){let r={superOutcome:"Referral",outcome:"Declined - "+e,result:"fail"};t&&(r.details=t),this.outcomeAdd(r)}productAddedToCart(e){let t={superOutcome:"Add Product To Cart",outcome:"Add - "+e,result:"success"};this.outcomeAdd(t),this.heartbeatState(1)}productNotAddedToCart(e){let t={superOutcome:"Add Product To Cart",outcome:"Ignore - "+e,result:"fail"};this.outcomeAdd(t)}upsold(e,t=null){let r={superOutcome:"Upsold Product",outcome:"Upsold - "+e,result:"success"};t&&(r.price=t),this.outcomeAdd(r)}upsellDismissed(e,t=null){let r={superOutcome:"Upsold Product",outcome:"Dismissed - "+e,result:"fail"};t&&(r.price=t),this.outcomeAdd(r)}checkOut(){let e={superOutcome:"Customer Checkout",outcome:"Check Out",result:"success"};this.outcomeAdd(e),this.heartbeatState(2)}checkoutCanceled(){let e={superOutcome:"Customer Checkout",outcome:"Canceled",result:"fail"};this.outcomeAdd(e)}productRemoved(e){let t={superOutcome:"Customer Checkout",outcome:"Product Removed - "+e,result:"fail"};this.outcomeAdd(t)}purchase(e,t=null){let r={superOutcome:"Customer Purchase",outcome:"Purchase - "+e,result:"success"};t&&(r.price=t),this.outcomeAdd(r),this.heartbeatState(3)}purchaseCancel(e=null,t=null){let o={superOutcome:"Customer Purchase",outcome:"Canceled"+(e?" - "+e:""),result:"fail"};t&&(o.price=t),this.outcomeAdd(o)}promiseFulfilled(){let e={superOutcome:"Promise Fulfillment",outcome:"Fulfilled",result:"success"};this.outcomeAdd(e)}promiseUnfulfilled(){let e={superOutcome:"Promise Fulfillment",outcome:"Unfulfilled",result:"fail"};this.outcomeAdd(e)}productKept(e){let t={superOutcome:"Product Disposition",outcome:"Kept - "+e,result:"success"};this.outcomeAdd(t)}productReturned(e){let t={superOutcome:"Product Disposition",outcome:"Returned - "+e,result:"fail"};this.outcomeAdd(t)}featureAttempted(e,t=null){let r={category:"Feature",action:"Attempted",name:e};t&&(r.details=t),this.journeyAdd(r)}featureCompleted(e,t=null){let r={category:"Feature",action:"Completed",name:e};t&&(r.details=t),this.journeyAdd(r)}featureFailed(e,t=null){let r={category:"Feature",action:"Failed",name:e};t&&(r.details=t),this.journeyAdd(r)}contentViewed(e,t=null){let r={category:"Content",action:"Viewed",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentEdited(e,t=null,r=null){let o={category:"Content",action:"Edited",type:e};t&&(o.identifier=t),r&&(o.details=r),this.journeyAdd(o)}contentCreated(e,t=null){let r={category:"Content",action:"Created",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentDeleted(e,t=null){let r={category:"Content",action:"Deleted",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentArchived(e,t=null){let r={category:"Content",action:"Archived",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentRequested(e,t=null){let r={category:"Content",action:"Requested",type:e};t&&(r.identifier=t),this.journeyAdd(r)}contentSearched(e){let t={category:"Content",action:"Searched",type:e};this.journeyAdd(t)}pageLoadTime(e,t){let r={category:"Performance",action:"Page Load Time - "+e.toString(),identifier:t};this.journeyAdd(r)}milestone(e,t,r,o){let i={category:e,action:t,name:r,details:o};this.journeyAdd(i)}commit(e=!1){if(!this.sampleDecision())return Promise.resolve(!0);let t={data:{id:this.id(),journey:this.journey(),token:this.apiKey,timestamp:new Date().getTime()/1e3}};return this.reset(),this.JourneyApi(this.apiUrl).fetch(t).catch(r=>(this.restore(),e?Promise.reject(r):Promise.resolve(!0)))}heartbeatState(e=null){let t=v("heartbeat_stage");return e&&e>t&&A("heartbeat_stage",e),!e&&!t&&A("heartbeat_stage",0),Number(v("heartbeat_stage"))}heartbeatMessage(e){let t=this.heartbeatState(),r={ecom:{0:{expires_in_seconds:600,if_abandoned:{superOutcome:"Add Product To Cart",outcome:"Abandoned",result:"fail"}},1:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Checkout",outcome:"Abandoned",result:"fail"}},2:{expires_in_seconds:600,if_abandoned:{superOutcome:"Customer Purchase",outcome:"Abandoned",result:"fail"}},3:{remove:!0}}};return Object.keys(r).includes(e)?r[e][t]:v("heartbeat_outcome")}heartbeat(e=!1){let t=_("view-platform"),r=_("view-tags"),o={data:{id:this.id(),journey:this.journey(),token:this.apiKey,platform:t||{},tags:r||[],timestamp:new Date().getTime()/1e3}},i=v("heartbeat_type");return i&&(o.data.watchdog=this.heartbeatMessage(i)),this.sampleDecision()?(this.reset(),this.HeartbeatApi(this.apiUrl).fetch(o).then(c=>(i&&Object.keys(o.data.watchdog).includes("remove")&&(T("heartbeat_stage"),T("heartbeat_type"),T("heartbeat_outcome")),Promise.resolve(c))).catch(c=>(this.restore(),e?Promise.reject(c):Promise.resolve(!0)))):Promise.resolve(!0)}deanonymize(e){if(!this.sampleDecision())return Promise.resolve(!0);let t={data:{id:this.id(),person:e,token:this.apiKey,timestamp:new Date().getTime()/1e3}};return this.DeanonApi(this.apiUrl).fetch(t)}id(e){return e&&C("xenon-view",e),e=_("xenon-view"),!e||e===""?this.newId():e}newId(){return C("xenon-view",crypto.randomUUID()),_("xenon-view")}sampleDecision(e=null,t=null){if(e!==null&&C("xenon-will-sample",e),e=_("xenon-will-sample"),e===null||e===""){let r={data:{id:this.id(),token:this.apiKey}};this.SampleApi(this.apiUrl).fetch(r).then(o=>{e=this.sampleDecision(o.sample,t)}).catch(o=>{if(o.authIssue&&t){t(o);return}e=this.sampleDecision(!0,t)})}return e=e!==null?!!e:null,e}outcomeAdd(e){let t=_("view-platform");t&&(e.platform=t);let r=_("view-tags");r&&(e.tags=r),this.journeyAdd(e)}journeyAdd(e){let t=this.journey();if(e.timestamp=new Date().getTime()/1e3,this.pageURL_&&(e.url=this.pageURL_),t&&t.length){let r=t[t.length-1];if(this.isDuplicate(r,e)){let o=r.hasOwnProperty("count")?r.count:1;r.count=o+1}else t.push(e)}else t=[e];this.storeJourney(t)}isDuplicate(e,t){let r=Object.keys(e),o=Object.keys(t);return!((c,p)=>{for(let h of p)if(!c.has(h))return!1;return!0})(new Set(r),new Set(o))||!o.includes("category")||!r.includes("category")||t.category!==e.category||!o.includes("action")||!r.includes("action")||t.action!==e.action?!1:this.duplicateFeature(e,t,r,o)||this.duplicateContent(e,t,r,o)||this.duplicateMilestone(e,t,r,o)}duplicateFeature(e,t,r,o){return t.category!=="Feature"||e.category!=="Feature"?!1:t.name===e.name}duplicateContent(e,t,r,o){return t.category!=="Content"||e.category!=="Content"?!1:!o.includes("type")&&!r.includes("type")?!0:t.type!==e.type?!1:!o.includes("identifier")&&!r.includes("identifier")?!0:t.identifier!==e.identifier?!1:!o.includes("details")&&!r.includes("details")?!0:t.details===e.details}duplicateMilestone(e,t,r,o){return t.category==="Feature"||e.category==="Feature"||t.category==="Content"||e.category==="Content"||t.name!==e.name?!1:t.details===e.details}journey(){return v("view-journey")}storeJourney(e){A("view-journey",e)}reset(){this.restoreJourney=this.journey(),T("view-journey"),this.storeJourney([])}restore(){let e=this.journey(),t=this.restoreJourney;e&&e.length&&(t=t.concat(e)),this.storeJourney(t),this.restoreJourney=[]}hasClassInHierarchy(e,t,r){let o=(i,c,p,h)=>h>=p?!1:i.className.toString().includes(c)?!0:i.parentElement?o(i.parentElement,c,p,h+1):!1;return o(e,t,r,0)}decipherParamsPerLibrary(e){return e.has("xenonSrc")?[e.get("xenonSrc"),e.get("xenonId")]:e.has("cr_campaignid")?["Cerebro",e.get("cr_campaignid")]:e.has("utm_source")&&e.get("utm_source").toLowerCase()==="klaviyo"?["Klaviyo"+(e.has("utm_medium")?" - "+e.get("utm_medium"):""),e.get("utm_campaign")]:e.has("g_campaignid")?["Google Ad",e.get("g_campaignid")]:e.has("utm_source")&&e.get("utm_source").toLowerCase()==="shareasale"?["Share-a-sale",e.get("sscid")]:e.has("g_adtype")&&e.get("g_adtype")==="none"?["Google Organic",e.get("g_campaign")]:e.has("g_adtype")&&e.get("g_adtype")==="search"?["Google Paid Search",e.get("g_campaign")]:e.has("utm_source")&&e.get("utm_source")==="facebook"?["Facebook Ad",e.get("utm_campaign")]:e.has("utm_source")&&e.get("utm_source").toLowerCase()==="email-broadcast"?["Email",e.get("utm_campaign")]:e.has("utm_source")&&e.get("utm_source").toLowerCase()==="youtube"?["YouTube",e.get("utm_campaign")]:[e.get("utm_source"),e.get("utm_campaign")]}autodiscoverLeadFrom(e){if(e&&e!==""&&e!=="?"){let t=new URLSearchParams(e),[r,o]=this.decipherParamsPerLibrary(t),i=_("view-tags");r&&(!i||!i.includes(r))&&(this.variant([r,o]),this.leadAttributed(r,o)),t.delete("xenonId"),t.delete("xenonSrc");let c="";return t.size&&(c="?"+t.toString()),c}return null}pageURL(e){this.pageURL_=e}};var He=new U,d=He;var $="1.0.3";var me=s=>{console.log("xenon-capture:%c Error: "+s,"color: #ff0000")};N(s=>{let e=s.settings.debug&&(s.settings.debug==="1"||s.settings.debug.toLowerCase()==="true"),t=s.settings.purchaseOnly&&(s.settings.purchaseOnly==="1"||s.settings.purchaseOnly.toLowerCase()==="true"),r=(o,...i)=>{e&&console.log("%c"+o,"color: #3333cc",...i)};s.settings.apiKey?(d.init(s.settings.apiKey,null,o=>{me(o.message)}),d.ecomAbandonment()):me("No API Key configured"),s.analytics.subscribe("all_events",o=>{switch(o.name){case"collection_viewed":t||(d.contentViewed("Collection",o.data.collection.title),r("Xenon.contentViewed","Collection",o.data.collection.title));break;case"checkout_contact_info_submitted":let i={email:o.data.checkout.email,name:[o.data.checkout.billingAddress.firstName,o.data.checkout.billingAddress.lastName].join(" ")};t?(d.milestone("Checkout","Contact",i.name,i.email),r("Xenon.milestone","Checkout","Contact",i.name,i.email),d.heartbeat()):(d.deanonymize(i).then(()=>{d.heartbeat()}),r("Xenon.deanonymize",i));break;case"checkout_shipping_info_submitted":d.contentCreated("shipping"),r("Xenon.contentCreated","shipping"),d.heartbeat();break;case"payment_info_submitted":d.contentCreated("billing"),r("Xenon.contentCreated","billing"),d.heartbeat();break;case"product_added_to_cart":t||(d.productAddedToCart(o.data.cartLine.merchandise.product.id),r("Xenon.productAddedToCart",o.data.cartLine.merchandise.product.id),d.heartbeat());break;case"product_removed_from_cart":t||(d.productRemoved(o.data.cartLine.merchandise.product.id),r("Xenon.productRemoved",o.data.cartLine.merchandise.product.id),s.init.data.cart.totalQuantity===0&&(d.cancelAbandonment(),r("Xenon.cancelAbandonment")),d.heartbeat());break;case"checkout_completed":o.data.checkout.transactions.map(g=>{d.milestone("Selection","Payment","Used",g.gateway),r("Xenon.milestone","Selection","Payment","Used",g.gateway)});let c=o.data.checkout.lineItems.map(g=>g.id),p=o.data.checkout.totalPrice.amount;d.purchase(c,p),r("Xenon.purchase",c,p),d.heartbeat();break;case"clicked":if(o.data.element.tagName!=="INPUT"){let g=o.data.element.tagName.charAt(0)+o.data.element.tagName.slice(1).toLowerCase()+o.data.element.type.charAt(0).toUpperCase()+o.data.element.type.slice(1);d.milestone(g,o.data.element.id,o.type,o.data.element.value),r("Xenon.milestone",g,o.data.element.id,o.type,o.data.element.value),d.heartbeat()}break;case"input_blurred":case"input_focused":break;case"input_changed":let h=o.data.element.tagName.charAt(0)+o.data.element.tagName.slice(1).toLowerCase()+o.data.element.type.charAt(0).toUpperCase()+o.data.element.type.slice(1);d.milestone(h,o.data.element.id,o.type,o.data.element.value),r("Xenon.milestone",h,o.data.element.id,o.type,o.data.element.value),d.heartbeat();break;case"xenon_link":d.milestone("Link",o.customData.id,o.customData.href,o.customData.text),r("Xenon.milestone","Link",o.customData.id,o.customData.href,o.customData.text),d.heartbeat();break;case"xenon_input":let f="Input"+o.customData.type.charAt(0).toUpperCase()+o.customData.type.slice(1);d.milestone(f,o.customData.id,o.customData.class,o.customData.text),r("Xenon.milestone",f,o.customData.id,o.customData.class,o.customData.text),d.heartbeat();break;case"xenon_button":let D="Button"+o.customData.type.charAt(0).toUpperCase()+o.customData.type.slice(1);d.milestone(D,o.customData.id,o.customData.class,o.customData.text),r("Xenon.milestone",D,o.customData.id,o.customData.class,o.customData.text),d.heartbeat();break;case"page_viewed":break;case"xenon_timing":s.browser.sessionStorage.getItem("xenon-platform").then(g=>{d.pageLoadTime(o.customData.loadTime.toString(),o.customData.href),r("Xenon.pageLoadTime:",o.customData.loadTime,o.customData.href),g||(d.platform($,"Pixel",o.customData.platform,s.init.context.navigator.userAgent),r("Xenon.platform",$,"Pixel",o.customData.platform,s.init.context.navigator.userAgent),s.browser.sessionStorage.setItem("xenon-platform",o.customData.platform)),d.heartbeat()});break;default:e&&console.log("%cXenon unmapped:","color: #ff8c00",o)}})});})();
